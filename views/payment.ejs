<% layout("/listings/layouts/boilerplate.ejs") %>

<div
  class="container my-5 p-5 bg-light shadow rounded text-center"
  style="max-width: 600px"
>
  <h2 class="mb-3 text-primary">Payment for <%= listing.title %></h2>
  <p class="text-muted">Confirm your booking and complete the payment below.</p>

  <div class="my-4">
    <img
      src="<%= listing.image ? listing.image.url : '/default.jpg' %>"
      alt="Listing Image"
      class="img-fluid rounded mb-3"
      style="height: 200px; object-fit: cover"
    />
    <h4 class="text-success">
      Total Amount: ₹<%= totalAmount.toLocaleString("en-IN") %>
    </h4>
  </div>

  <button id="rzp-button1" class="btn btn-dark btn-lg mt-3">
    <i class="bi bi-credit-card"></i> Proceed to Payment
  </button>

  <p class="mt-3 text-muted small">
    You’ll be redirected to a secure Razorpay payment window.
  </p>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
  const totalAmount = Number(<%- totalAmount %>);
  const options = {
    key: "<%- razorpayKeyId %>",
    amount: totalAmount * 100,
    currency: "INR",
    name: "Hotel Booking",
    description: "Payment for <%- listing.title %>",
    image: "<%- listing.image ? listing.image.url : '/default.jpg' %>",
    handler: function(response){
      alert("✅ Booking Confirmed! Payment Successful.");
      window.location.href = "/listings/<%- listing._id %>";
    },
    theme: { color: "#0d6efd" },
  };

  document.getElementById("rzp-button1").onclick = function(e){
    const rzp1 = new Razorpay(options);
    rzp1.open();
    e.preventDefault();
  }
</script>
